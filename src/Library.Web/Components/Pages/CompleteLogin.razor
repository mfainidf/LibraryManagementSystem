@page "/complete-login"
@using Library.Web.Services
@using Microsoft.AspNetCore.Components.Web
@inject WebAuthenticationService WebAuth
@inject NavigationManager Navigation
@rendermode @(new InteractiveServerRenderMode(prerender: false))

<div class="container mt-5 text-center">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Completing your login...</p>
</div>

@code {
    [SupplyParameterFromQuery]
    public string? Email { get; set; }

    [SupplyParameterFromQuery]
    public string? Password { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(Email) && !string.IsNullOrEmpty(Password))
        {
            var (success, user) = await WebAuth.LoginAsync(Email, Password);
            if (success && user != null)
            {
                // Login completato con successo, reindirizza alla dashboard
                Navigation.NavigateTo("/dashboard", true);
            }
            else
            {
                // Login fallito, torna alla pagina di login
                Navigation.NavigateTo("/login", true);
            }
        }
        else
        {
            // Parametri mancanti, torna alla pagina di login
            Navigation.NavigateTo("/login", true);
        }
    }
}
